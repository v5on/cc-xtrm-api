<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CC Gen Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .active-tab {
      @apply bg-blue-600 text-white;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body class="bg-gray-100 p-4 text-gray-800">
  <div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-lg">
    <div class="flex justify-center gap-4 mb-6">
      <button onclick="switchTab('generate')" id="tab-generate" class="px-4 py-2 rounded bg-blue-100">ðŸŽ¯ Card Generate</button>
      <button onclick="switchTab('bin')" id="tab-bin" class="px-4 py-2 rounded bg-blue-100">ðŸ”Ž BIN Info</button>
      <button onclick="switchTab('download')" id="tab-download" class="px-4 py-2 rounded bg-blue-100">ðŸ“„ Card Download</button>
    </div>

    <!-- âœ… CARD GENERATE TAB -->
    <div id="generate" class="tab-content active">
      <h2 class="text-xl font-semibold mb-2">Generate Cards</h2>
      <form onsubmit="generateCards(event)">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3">
          <input name="bin" required placeholder="BIN (e.g. 51546200278xxxxx)" class="p-2 border rounded" />
          <input name="limit" placeholder="Limit (e.g. 10)" class="p-2 border rounded" />
          <input name="month" placeholder="Month (e.g. 01)" class="p-2 border rounded" />
          <input name="year" placeholder="Year (e.g. 28)" class="p-2 border rounded" />
          <input name="cvv" placeholder="CVV (e.g. 000 or rnd)" class="p-2 border rounded" />
        </div>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Generate</button>
      </form>
      <div class="mt-4">
        <pre id="generate-output" class="bg-gray-100 p-3 rounded whitespace-pre-wrap"></pre>
        <div class="flex gap-2 mt-2" id="generate-buttons" style="display: none;">
          <button onclick="copyCardsOnly()" class="px-3 py-1 bg-green-600 text-white rounded">Copy Cards</button>
          <button onclick="copyFull()" class="px-3 py-1 bg-gray-700 text-white rounded">Copy All</button>
        </div>
      </div>
    </div>

    <!-- ðŸ” BIN INFO TAB -->
    <div id="bin" class="tab-content">
      <h2 class="text-xl font-semibold mb-2">BIN Information</h2>
      <form onsubmit="getBinInfo(event)">
        <input name="bin" required placeholder="BIN (e.g. 515462)" class="p-2 border rounded w-full mb-2" />
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Get Info</button>
      </form>
      <div class="mt-4">
        <pre id="bin-output" class="bg-gray-100 p-3 rounded whitespace-pre-wrap"></pre>
        <button onclick="copyBin()" class="mt-2 px-3 py-1 bg-blue-800 text-white rounded" style="display: none;" id="bin-copy-btn">Copy Info</button>
      </div>
    </div>

    <!-- ðŸ“„ TXT DOWNLOAD TAB -->
    <div id="download" class="tab-content">
      <h2 class="text-xl font-semibold mb-2">Download Cards (TXT)</h2>
      <form onsubmit="downloadTxt(event)">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3">
          <input name="bin" required placeholder="BIN (e.g. 51546200278xxxxx)" class="p-2 border rounded" />
          <input name="limit" placeholder="Limit (e.g. 10)" class="p-2 border rounded" />
          <input name="month" placeholder="Month (e.g. 01)" class="p-2 border rounded" />
          <input name="year" placeholder="Year (e.g. 28)" class="p-2 border rounded" />
          <input name="cvv" placeholder="CVV (e.g. 000 or rnd)" class="p-2 border rounded" />
        </div>
        <button type="submit" class="bg-purple-700 text-white px-4 py-2 rounded">Download</button>
      </form>
    </div>
  </div>

  <script>
    function switchTab(id) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('button[id^="tab-"]').forEach(b => b.classList.remove('active-tab'));
      document.getElementById(id).classList.add('active');
      document.getElementById("tab-" + id).classList.add('active-tab');
    }

    async function generateCards(e) {
      e.preventDefault();
      const form = e.target;
      const params = new URLSearchParams();
      params.append("bin", form.bin.value);
      if (form.limit.value) params.append("limit", form.limit.value);
      if (form.month.value) params.append("month", form.month.value);
      if (form.year.value) params.append("year", form.year.value);
      if (form.cvv.value) params.append("cvv", form.cvv.value);
      const res = await fetch("/generate?" + params.toString());
      const text = await res.text();
      document.getElementById("generate-output").textContent = text;
      document.getElementById("generate-buttons").style.display = "flex";
    }

    async function getBinInfo(e) {
      e.preventDefault();
      const bin = e.target.bin.value;
      const res = await fetch(`/bin-info?bin=${bin}`);
      const html = await res.text();
      const match = html.match(/<pre id="bin-output"[^>]*>(.*?)<\/pre>/s);
      const info = match ? match[1] : "Error fetching info.";
      document.getElementById("bin-output").textContent = decodeHTMLEntities(info);
      document.getElementById("bin-copy-btn").style.display = "inline-block";
    }

    async function downloadTxt(e) {
      e.preventDefault();
      const form = e.target;
      const params = new URLSearchParams();
      params.append("bin", form.bin.value);
      if (form.limit.value) params.append("limit", form.limit.value);
      if (form.month.value) params.append("month", form.month.value);
      if (form.year.value) params.append("year", form.year.value);
      if (form.cvv.value) params.append("cvv", form.cvv.value);
      window.open("/generate/view?" + params.toString(), "_blank");
    }

    function copyCardsOnly() {
      const lines = document.getElementById("generate-output").textContent.split("\n");
      const onlyCards = lines
        .filter(l => /^\d{12,19}/.test(l))
        .map(l => l.split("|")[0])
        .join("\n");
      navigator.clipboard.writeText(onlyCards);
      alert("Card numbers copied!");
    }

    function copyFull() {
      const text = document.getElementById("generate-output").textContent;
      navigator.clipboard.writeText(text);
      alert("Full output copied!");
    }

    function copyBin() {
      const text = document.getElementById("bin-output").textContent;
      navigator.clipboard.writeText(text);
      alert("BIN Info copied!");
    }

    function decodeHTMLEntities(str) {
      const txt = document.createElement("textarea");
      txt.innerHTML = str;
      return txt.value;
    }
  </script>
</body>
</html>
